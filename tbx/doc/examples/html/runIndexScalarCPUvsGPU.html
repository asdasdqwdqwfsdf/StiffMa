<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB R2020a"><title>Script to run the INDEX code for the SCALAR problem: CPU vs GPU</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin-bottom: 20px; padding-bottom: 4px;  }
.S3 { margin: 0px; padding: 10px 0px 10px 5px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 700; text-align: start;  }
.S4 { margin: -1px 0px 0px; padding: 10px 0px 10px 7px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: start;  }
.S5 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S6 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S7 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px 4px 0px 0px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S10 { color: rgb(64, 64, 64); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 17.234px;  }
.embeddedOutputsErrorElement {min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
.embeddedOutputsWarningElement{min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
.diagnosticMessage-wrapper {font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {color: rgb(255,100,0);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {color: rgb(255,100,0); text-decoration: underline;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {color: rgb(230,0,0);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {color: rgb(230,0,0); text-decoration: underline;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart,.diagnosticMessage-wrapper .diagnosticMessage-causePart {white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {white-space: pre; word-wrap: initial; min-height: 18px; max-height: 250px; overflow: auto;}
.textElement,.rtcDataTipElement .textElement {padding-top: 3px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {min-height: 16px;}
.rightPaneElement .textElement {padding-top: 2px; padding-left: 9px;}
.S11 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S12 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S13 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S14 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S15 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }</style></head><body><div class = rtcContent><h1  class = 'S0' id = 'T_EE119605' ><span>Script to run the INDEX code for the SCALAR problem: CPU vs GPU</span></h1><div  class = 'S1'><span>This script is used to generate the row indices </span><span texencoding="$\mathbf{k}_i$" style="vertical-align:-6px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAoCAYAAADt5povAAAB6UlEQVRYR+3WS8hNYRTG8d+XIoQhRUmRkQkDksTABCMlDCRyKZfCAGUgKcRALgNFUXIpA32jL0Yot1BmIilDJYXM3Fp6d71O57L36eyTOG/t0X73/reetdaz1pA+n6E+8wyAPVf8/5N0Hq5idoOWi/CgF/o2k3QGrmN+BqgVOA6nsblfwLE4hW0DYDdF1Kxo/ipJJ+IYVmB6FuFj7MTzTlF3G+Fi3MMt7Mcb/OwEi/fdAMfjRPo2YF/KgIo7VYFjsBfTsA9fq8CqRvgswWZhDz5VhVUBLsECHMc7bEg5rMwsK+lDLMz+Ppyc6H1VYlngSUzB+gxwFIfwrQV0VErBAazEoyqSxrT4iEvZFInq3IobbYAHsSlPQdkIAxiyrsN5TEiQJ9iIl2WlrQKMARy2Fz0YrlKcC6lqS7VIM2CneTgVV7A0g+7GmeQ2kbs5iO1hLl7jLH60ymGzib8cIxkgZmVIW5zGVolAoqDiWZUs8Pfdxghb7TRRMAE4gi3Y0WTvCehqPE3SxxCP3l2DV+2srWz+292LSXItmfoufK4buAx3ELk9h+91AiNN0X/bsRb3cynq2Lwn4SJGJ2hU/dsiyjqAM5P73MULfMDtYkDXAZyMy4j2Ooybud/WAWxb5QNgL0zgj3/8+5L+AjY3bilTy2BJAAAAAElFTkSuQmCC" width="14" height="20" /></span><span> and column indices </span><span texencoding="$\mathbf{k}_j$" style="vertical-align:-6px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAoCAYAAABw65OnAAACJElEQVRYR+3XTahNURjG8d/NQAgTA0VkIBMxkHwmppRQkoGkfAx8hAFDSXF9lChRyEBioCQDYwMiDCVlQEaIQgaK6K21a99j73P22fecc8/grPFee/173+d51ruG9MEa6gMGA4isC4NK9HUlFuEW5jW4ZiUed8tJRZqYg9tYkju05xATcQE7xxJiAs5jzwBiUImkgWaamIJTWIfZOc08xT68rGPjIotWEeYqPMI9HMVb/K0DEHvqQEzCmbQ3AH7UPbxZbDerxHgcxkwcwc/RArRbiRcJYC4O4VsnANqBWI2lGMZ7bE+a6AhHVU08wfLcifdTon7sBEVViLOYjm25Q0/iGH5XBFmGS+lyPJd3U1WIuEW/4kbudg1X7MadihAr0phwPbnrVx13REu24gompx88ww68rghS+Fk7lYihJuwbGRHpmK2ryS217VoE0WqemIGbWJMDOYiLJakZ8T4fCxH2Po53+ZJUnazW4mFuY8wa0ZZstbLtrCTID9iLL80gymbMEGUcegK70o8a59AA2YznBY1fgLtJ2NHOP60qMRqNle1dj8iWTenSG/FdLx4/41IFN6RKvWok7QXEVFxLLfhPD2V3R6fbkekhQi2cMUIPvYLYklK1UA+9gMj0EBYPmDdFZe62JqalYPuE/fg+FhCROw/SFBZv3MI5tBuViEk83rIbU1QvxgF8LlN8NyAiSS8jbti4bU8j4rp0dQOibYv3BcQ/ZvZ4KfNYFAwAAAAASUVORK5CYII=" width="16.5" height="20" /></span><span> needed for the generation of the global stiffness matrix </span><span texencoding="$\mathbf{K}$" style="vertical-align:-5px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAkCAYAAAB15jFqAAAB3klEQVRYR+3WPciOYRQH8N8rq0VJJmWRIgaxKDKZSFlEpIgshFBIFsnnQD6LlI9FiY2iKMlmk4GYZGGQRIpOXXfdXe6P535vT+/wvGe9rnP+1/lf5/zPGTMBNjYBmCZBh8r66NI7ByewBLNrOP6IJ9iHr1iDXViI6ZnPNzzFHrwvzuronYaz2JoFuYQDiGC5zccdLMAjnMZz/MovNv3pJtzMHCKrhzUMrMQtXMUpfK+rxibQDSlI2XcZXlQEm4fruI3L+N1U/v8DdC6uJVaCmUbAeExf0Ci2C+kPWzNsK6Q4b6N3Jq7gJc4MkmFf0AA8j7c4jh9dJGw89L5JvbwND7Adn4cJugqrsbMEEtQews9Bgbtm+gmzKlRnB+7izyDAXUFDkd4ltSnHD2ncjGfDAA1xeI2TGcWBFaKxER/agLtmWihS0S4hi2W7iP1NEthXHBbjXsU0OtjWt+PNtHjw+qS1MZUKiwm0Do+HJfhTsTf1bRnjFbYgevof65NpEWxGksO1WfRa4egKujwN5vz1MdpuYGl2EBJ5NNflrpvDORypqM4pOIbDgwhHDho7Ukz9FRX7ThHvS9Lc+Muw6NmYqYtQLqhyYd3H7rRTTW74bULW73x0N/x+vA3oPTr0/gUOhHElRPbQjgAAAABJRU5ErkJggg==" width="14.5" height="18" /></span><span> for the SCALAR problem: comparision between CPU and GPU.</span></div><div  class = 'S1'><span>For more information, see the </span><a href = "https://github.com/fjramireg/StiffMa"><span>StiffMa</span></a><span> web site.</span></div><div  class = 'S2'><div  class = 'S3'><span style=' font-weight: bold;'>Table of Contents</span></div><div  class = 'S4'><a href = "#H_83581889"><span>Inputs
</span></a><a href = "#H_0EE8089F"><span>Mesh generation
</span></a><a href = "#H_D584400C"><span>Material properties
</span></a><a href = "#H_638E11C5"><span>General Settings
</span></a><a href = "#H_CC4DEBD9"><span>GPU Settings
</span></a><a href = "#H_B5E9A4B9"><span>Index computation on CPU
</span></a><a href = "#H_A9B0B3D6"><span>Index computation on CPU (vectorized)
</span></a><a href = "#H_41673B3C"><span>Index computation on CPU (symmetry)
</span></a><a href = "#H_2DCD06D9"><span>Index computation on GPU (symmetry)
</span></a><a href = "#H_622D9A2E"><span>Difference between results
</span></a><a href = "#H_8FBF1AC3"><span>Credits</span></a></div></div><h2  class = 'S5' id = 'H_83581889' ><span>Inputs</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>nelx = 10;              </span><span style="color: rgb(60, 118, 61);">% Number of elements on X-direction</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>nely = 10;              </span><span style="color: rgb(60, 118, 61);">% Number of elements on Y-direction</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>nelz = 10;              </span><span style="color: rgb(60, 118, 61);">% Number of elements on Z-direction</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.dTE = </span><span style="color: rgb(160, 32, 240);">'uint32'</span><span>;    </span><span style="color: rgb(60, 118, 61);">% Data precision for "elements" ['uint32', 'uint64']</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>sets.dTN = </span><span style="color: rgb(160, 32, 240);">'single'</span><span>;    </span><span style="color: rgb(60, 118, 61);">% Data precision for "nodes" ['single' or 'double']</span></span></div></div></div><h2  class = 'S5' id = 'H_0EE8089F' ><span>Mesh generation</span></h2><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S9'><span style="white-space: pre;"><span>[Mesh.elements, Mesh.nodes] = CreateMesh2(nelx, nely, nelz, sets);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement scrollableOutput" uid="B0655A99" contenteditable="false" data-testid="output_0" data-width="428" data-height="18" data-hashorizontaloverflow="true" style="width: 458px; max-height: 261px;"><div class="textElement">	Mesh created successfully with 1000 Hex8 elements and 1331 nodes!</div></div></div></div></div><h2  class = 'S5' id = 'H_D584400C' ><span>Material properties</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S11'><span style="white-space: pre;"><span>c = 1.0;            </span><span style="color: rgb(60, 118, 61);">% Conductivity (homogeneous, linear, isotropic material)</span></span></div></div></div><h2  class = 'S5' id = 'H_638E11C5' ><span>General Settings</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>[sets.nel, sets.nxe]  = size(Mesh.elements);    </span><span style="color: rgb(60, 118, 61);">% Number of elements in the mesh &amp; Number of nodes per element</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>[sets.nnod, sets.dim] = size(Mesh.nodes);       </span><span style="color: rgb(60, 118, 61);">% Number of nodes in the mesh &amp; Space dimension</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.dxn = 1;                                   </span><span style="color: rgb(60, 118, 61);">% Number of DOFs per node for the scalar problem</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.edof = sets.dxn * sets.nxe;                </span><span style="color: rgb(60, 118, 61);">% Number of DOFs per element</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.sz = (sets.edof * (sets.edof + 1) )/2;     </span><span style="color: rgb(60, 118, 61);">% Number of NNZ values for each Ke using simmetry</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>sets.tdofs = sets.nnod * sets.dxn;              </span><span style="color: rgb(60, 118, 61);">% Number of total DOFs in the mesh</span></span></div></div></div><h2  class = 'S5' id = 'H_CC4DEBD9' ><span>GPU Settings</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>d = gpuDevice;                          </span><span style="color: rgb(60, 118, 61);">% Selects the GPU device </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.tbs      = d.MaxThreadsPerBlock;   </span><span style="color: rgb(60, 118, 61);">% Thread Block Size</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.numSMs   = d.MultiprocessorCount;  </span><span style="color: rgb(60, 118, 61);">% Number of multiprocessors on the device</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>sets.WarpSize = d.SIMDWidth;            </span><span style="color: rgb(60, 118, 61);">% The warp size in threads</span></span></div></div></div><h2  class = 'S5' id = 'H_B5E9A4B9' ><span>Index computation on CPU</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>[iKhf, jKhf] = Index_ssa(Mesh.elements, sets);	</span><span style="color: rgb(60, 118, 61);">% Row/column indices of tril(K)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>times = toc;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'Elapsed time for computing row/column indices of K on serial CPU: %f\n'</span><span>,times);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement scrollableOutput" uid="F40C91EF" contenteditable="false" data-testid="output_1" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="true"><div class="textElement">Elapsed time for computing row/column indices of K on serial CPU: 0.005331</div></div></div></div></div><h2  class = 'S5' id = 'H_A9B0B3D6' ><span>Index computation on CPU (vectorized)</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>[iKhfv, jKhfv] = Index_sa(Mesh.elements', sets);	</span><span style="color: rgb(60, 118, 61);">% Row/column indices of K</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>time1 = toc;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'Elapsed time for computing row/column indices of K on CPU (vectorized): %f\n'</span><span>,time1);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement scrollableOutput" uid="C87496A9" contenteditable="false" data-testid="output_2" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="true"><div class="textElement">Elapsed time for computing row/column indices of K on CPU (vectorized): 0.003677</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tSpeedup (loop vs vectorized): %f\n'</span><span>,times/time1);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="24831A6A" contenteditable="false" data-testid="output_3" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	Speedup (loop vs vectorized): 1.449863</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'Difference between results:\n'</span><span>);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="90D695FB" contenteditable="false" data-testid="output_4" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">Difference between results:</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tShould be %d!: %d\n'</span><span>, sets.edof^2*sets.nel, sum(iKhf==iKhfv));</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="CCD40468" contenteditable="false" data-testid="output_5" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	Should be 64000!: 64000</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tShould be %d!: %d\n\n'</span><span>, sets.edof^2*sets.nel, sum(jKhf==jKhfv));</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="7CC920EE" contenteditable="false" data-testid="output_6" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	Should be 64000!: 64000</div></div></div></div></div><h2  class = 'S5' id = 'H_41673B3C' ><span>Index computation on CPU (symmetry)</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>[iK_h, jK_h] = Index_sssa(Mesh.elements, sets);	</span><span style="color: rgb(60, 118, 61);">% Row/column indices of tril(K)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>time_h = toc;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'Elapsed time for computing row/column indices of tril(K) on serial CPU: %f\n'</span><span>,time_h);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement scrollableOutput" uid="925351BB" contenteditable="false" data-testid="output_7" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="true"><div class="textElement">Elapsed time for computing row/column indices of tril(K) on serial CPU: 0.008418</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tCPU speedup (Full vs Symmetry): %f\n'</span><span>,times/time_h);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="7F4E059B" contenteditable="false" data-testid="output_8" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	CPU speedup (Full vs Symmetry): 0.633256</div></div></div></div></div><h2  class = 'S5' id = 'H_2DCD06D9' ><span>Index computation on GPU (symmetry)</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>elementsGPU = gpuArray(Mesh.elements');          </span><span style="color: rgb(60, 118, 61);">% Transfer transposed array to GPU memory</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>[iK_d, jK_d] = Index_spsa(elementsGPU, sets);	</span><span style="color: rgb(60, 118, 61);">% Row/column indices of tril(K)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>time_d = toc;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'Elapsed time for computing row/column indices of tril(K) on serial CPU: %f\n'</span><span>,time_d);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement scrollableOutput" uid="6728D91F" contenteditable="false" data-testid="output_9" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="true"><div class="textElement">Elapsed time for computing row/column indices of tril(K) on serial CPU: 0.033260</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tGPU speedup: %f\n'</span><span>,time_h/time_d);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="49F9280D" contenteditable="false" data-testid="output_10" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	GPU speedup: 0.253107</div></div></div></div></div><h2  class = 'S5' id = 'H_622D9A2E' ><span>Difference between results</span></h2><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S9'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tCPU vs GPU (iKh vs iKd): %e\n'</span><span>,norm(double(iK_h(:))-double(iK_d(:))));</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="BAC00C41" contenteditable="false" data-testid="output_11" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	CPU vs GPU (iKh vs iKd): 0.000000e+00</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tCPU vs GPU (jKh vs jKd): %e\n'</span><span>,norm(double(jK_h(:))-double(jK_d(:))));</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="E0436A03" contenteditable="false" data-testid="output_12" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	CPU vs GPU (jKh vs jKd): 0.000000e+00</div></div></div></div></div><h2  class = 'S5' id = 'H_8FBF1AC3' ><span>Credits</span></h2><div  class = 'S1'><span>Written by </span><span style=' font-weight: bold;'>Francisco Javier Ramírez-Gil</span><span>, </span><a href = "http://fjramireg@gmail.com"><span>fjramireg@gmail.com</span></a></div><div  class = 'S1'><span>Code site:</span></div><ul  class = 'S14'><li  class = 'S15'><a href = "https://github.com/fjramireg/StiffMa"><span>https://github.com/fjramireg/StiffMa</span></a></li><li  class = 'S15'><a href = "https://www.mathworks.com/matlabcentral/fileexchange/76947-stiffma"><span>https://www.mathworks.com/matlabcentral/fileexchange/76947-stiffma</span></a></li></ul><div  class = 'S1'><span>Sponsors: </span></div><ul  class = 'S14'><li  class = 'S15'><a href = "https://pascualbravo.edu.co/"><span>Institución Universitaria Pascual Bravo</span></a></li><li  class = 'S15'><a href = "https://medellin.unal.edu.co/"><span>Universidad Nacional de Colombia - Medellin</span></a></li></ul><div  class = 'S1'><span>Created:  January 31, 2020. Version: 1.4</span></div><div  class = 'S1'><span>Modified:  June 15, 2020. Version: 1.5</span></div><div  class = 'S1'></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Script to run the INDEX code for the SCALAR problem: CPU vs GPU
% This script is used to generate the row indices $$\mathbf{k}_i$$ and column 
% indices $$\mathbf{k}_j$$ needed for the generation of the global stiffness matrix 
% $$\mathbf{K}$$ for the SCALAR problem: comparision between CPU and GPU.
% 
% For more information, see the <https://github.com/fjramireg/StiffMa StiffMa> 
% web site.
%% Inputs

nelx = 10;              % Number of elements on X-direction
nely = 10;              % Number of elements on Y-direction
nelz = 10;              % Number of elements on Z-direction
sets.dTE = 'uint32';    % Data precision for "elements" ['uint32', 'uint64']
sets.dTN = 'single';    % Data precision for "nodes" ['single' or 'double']
%% Mesh generation

[Mesh.elements, Mesh.nodes] = CreateMesh2(nelx, nely, nelz, sets);
%% Material properties

c = 1.0;            % Conductivity (homogeneous, linear, isotropic material)
%% General Settings

[sets.nel, sets.nxe]  = size(Mesh.elements);    % Number of elements in the mesh & Number of nodes per element
[sets.nnod, sets.dim] = size(Mesh.nodes);       % Number of nodes in the mesh & Space dimension
sets.dxn = 1;                                   % Number of DOFs per node for the scalar problem
sets.edof = sets.dxn * sets.nxe;                % Number of DOFs per element
sets.sz = (sets.edof * (sets.edof + 1) )/2;     % Number of NNZ values for each Ke using simmetry
sets.tdofs = sets.nnod * sets.dxn;              % Number of total DOFs in the mesh
%% GPU Settings

d = gpuDevice;                          % Selects the GPU device 
sets.tbs      = d.MaxThreadsPerBlock;   % Thread Block Size
sets.numSMs   = d.MultiprocessorCount;  % Number of multiprocessors on the device
sets.WarpSize = d.SIMDWidth;            % The warp size in threads
%% Index computation on CPU

tic;
[iKhf, jKhf] = Index_ssa(Mesh.elements, sets);	% Row/column indices of tril(K)
times = toc;
fprintf('Elapsed time for computing row/column indices of K on serial CPU: %f\n',times);
%% Index computation on CPU (vectorized)

tic;
[iKhfv, jKhfv] = Index_sa(Mesh.elements', sets);	% Row/column indices of K
time1 = toc;
fprintf('Elapsed time for computing row/column indices of K on CPU (vectorized): %f\n',time1);
fprintf('\tSpeedup (loop vs vectorized): %f\n',times/time1);
fprintf('Difference between results:\n');
fprintf('\tShould be %d!: %d\n', sets.edof^2*sets.nel, sum(iKhf==iKhfv));
fprintf('\tShould be %d!: %d\n\n', sets.edof^2*sets.nel, sum(jKhf==jKhfv));
%% Index computation on CPU (symmetry)

tic;
[iK_h, jK_h] = Index_sssa(Mesh.elements, sets);	% Row/column indices of tril(K)
time_h = toc;
fprintf('Elapsed time for computing row/column indices of tril(K) on serial CPU: %f\n',time_h);
fprintf('\tCPU speedup (Full vs Symmetry): %f\n',times/time_h);
%% Index computation on GPU (symmetry)

tic;
elementsGPU = gpuArray(Mesh.elements');          % Transfer transposed array to GPU memory
[iK_d, jK_d] = Index_spsa(elementsGPU, sets);	% Row/column indices of tril(K)
time_d = toc;
fprintf('Elapsed time for computing row/column indices of tril(K) on serial CPU: %f\n',time_d);
fprintf('\tGPU speedup: %f\n',time_h/time_d);
%% Difference between results

fprintf('\tCPU vs GPU (iKh vs iKd): %e\n',norm(double(iK_h(:))-double(iK_d(:))));
fprintf('\tCPU vs GPU (jKh vs jKd): %e\n',norm(double(jK_h(:))-double(jK_d(:))));
%% Credits
% Written by *Francisco Javier Ramírez-Gil*, <http://fjramireg@gmail.com fjramireg@gmail.com>
% 
% Code site:
%% 
% * <https://github.com/fjramireg/StiffMa https://github.com/fjramireg/StiffMa>
% * <https://www.mathworks.com/matlabcentral/fileexchange/76947-stiffma https://www.mathworks.com/matlabcentral/fileexchange/76947-stiffma>
%% 
% Sponsors: 
%% 
% * <https://pascualbravo.edu.co/ Institución Universitaria Pascual Bravo>
% * <https://medellin.unal.edu.co/ Universidad Nacional de Colombia - Medellin>
%% 
% Created:  January 31, 2020. Version: 1.4
% 
% Modified:  June 15, 2020. Version: 1.5
% 
%
##### SOURCE END #####
--></body></html>