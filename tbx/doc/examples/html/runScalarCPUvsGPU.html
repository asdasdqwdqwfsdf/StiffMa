<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB R2020a"><title>Runs the whole assembly SCALAR code on the CPU and GPU: a comparision</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin-bottom: 20px; padding-bottom: 4px;  }
.S3 { margin: 0px; padding: 10px 0px 10px 5px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 700; text-align: start;  }
.S4 { margin: -1px 0px 0px; padding: 10px 0px 10px 7px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: start;  }
.S5 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S6 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S7 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px 4px 0px 0px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S10 { color: rgb(64, 64, 64); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 17.234px;  }
.embeddedOutputsErrorElement {min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
.embeddedOutputsWarningElement{min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
.diagnosticMessage-wrapper {font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {color: rgb(255,100,0);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {color: rgb(255,100,0); text-decoration: underline;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {color: rgb(230,0,0);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {color: rgb(230,0,0); text-decoration: underline;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart,.diagnosticMessage-wrapper .diagnosticMessage-causePart {white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {white-space: pre; word-wrap: initial; min-height: 18px; max-height: 250px; overflow: auto;}
.textElement,.rtcDataTipElement .textElement {padding-top: 3px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {min-height: 16px;}
.rightPaneElement .textElement {padding-top: 2px; padding-left: 9px;}
.S11 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S12 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S13 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S14 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S15 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S16 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S17 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }</style></head><body><div class = rtcContent><h1  class = 'S0' id = 'T_72ACB972' ><span>Runs the whole assembly SCALAR code on the CPU and GPU: a comparision</span></h1><div  class = 'S1'><span></span></div><div  class = 'S1'><span>This script is used to generate the global stiffness matrix </span><span texencoding="$\mathbf{K}$" style="vertical-align:-5px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAkCAYAAAB15jFqAAAB3klEQVRYR+3WPciOYRQH8N8rq0VJJmWRIgaxKDKZSFlEpIgshFBIFsnnQD6LlI9FiY2iKMlmk4GYZGGQRIpOXXfdXe6P535vT+/wvGe9rnP+1/lf5/zPGTMBNjYBmCZBh8r66NI7ByewBLNrOP6IJ9iHr1iDXViI6ZnPNzzFHrwvzuronYaz2JoFuYQDiGC5zccdLMAjnMZz/MovNv3pJtzMHCKrhzUMrMQtXMUpfK+rxibQDSlI2XcZXlQEm4fruI3L+N1U/v8DdC6uJVaCmUbAeExf0Ci2C+kPWzNsK6Q4b6N3Jq7gJc4MkmFf0AA8j7c4jh9dJGw89L5JvbwND7Adn4cJugqrsbMEEtQews9Bgbtm+gmzKlRnB+7izyDAXUFDkd4ltSnHD2ncjGfDAA1xeI2TGcWBFaKxER/agLtmWihS0S4hi2W7iP1NEthXHBbjXsU0OtjWt+PNtHjw+qS1MZUKiwm0Do+HJfhTsTf1bRnjFbYgevof65NpEWxGksO1WfRa4egKujwN5vz1MdpuYGl2EBJ5NNflrpvDORypqM4pOIbDgwhHDho7Ukz9FRX7ThHvS9Lc+Muw6NmYqYtQLqhyYd3H7rRTTW74bULW73x0N/x+vA3oPTr0/gUOhHElRPbQjgAAAABJRU5ErkJggg==" width="14.5" height="18" /></span><span> for the SCALAR problem (linear stationary thermal conduction) on the CPU and GPU: a comparision.</span></div><div  class = 'S1'><span>For more information, see the </span><a href = "https://github.com/fjramireg/StiffMa"><span>StiffMa</span></a><span> web site.</span></div><div  class = 'S2'><div  class = 'S3'><span style=' font-weight: bold;'>Table of Contents</span></div><div  class = 'S4'><a href = "#H_83581889"><span>Inputs
</span></a><a href = "#H_0EE8089F"><span>Mesh generation
</span></a><a href = "#H_D584400C"><span>Material properties
</span></a><a href = "#H_638E11C5"><span>General Settings
</span></a><a href = "#H_B41C36B4"><span>GPU Settings
</span></a><a href = "#H_97FB7E91"><span>Creation of global stiffness matrix on CPU (serial)
</span></a><a href = "#H_74D8AFE6"><span>Creation of global stiffness matrix on CPU (serial) taking advantage of symmetry
</span></a><a href = "#H_CEE43F82"><span>Creation of global stiffness matrix on GPU
</span></a><a href = "#H_B7F87615"><span>Difference between results
</span></a><a href = "#H_DC2DCC8A"><span>Credits</span></a></div></div><div  class = 'S1'><span></span></div><h2  class = 'S5' id = 'H_83581889' ><span>Inputs</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>nelx = 10;              </span><span style="color: rgb(60, 118, 61);">% Number of elements on X-direction</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>nely = 10;              </span><span style="color: rgb(60, 118, 61);">% Number of elements on Y-direction</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>nelz = 10;              </span><span style="color: rgb(60, 118, 61);">% Number of elements on Z-direction</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.dTE = </span><span style="color: rgb(160, 32, 240);">'uint32'</span><span>;    </span><span style="color: rgb(60, 118, 61);">% Data precision for "elements" ['uint32', 'uint64']</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>sets.dTN = </span><span style="color: rgb(160, 32, 240);">'double'</span><span>;    </span><span style="color: rgb(60, 118, 61);">% Data precision for "nodes" ['single' or 'double']</span></span></div></div></div><h2  class = 'S5' id = 'H_0EE8089F' ><span>Mesh generation</span></h2><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S9'><span style="white-space: pre;"><span>[Mesh.elements, Mesh.nodes] = CreateMesh2(nelx, nely, nelz, sets);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement scrollableOutput" uid="CE8B716E" contenteditable="false" data-testid="output_0" data-width="428" data-height="18" data-hashorizontaloverflow="true" style="width: 458px; max-height: 261px;"><div class="textElement">	Mesh created successfully with 1000 Hex8 elements and 1331 nodes!</div></div></div></div></div><h2  class = 'S5' id = 'H_D584400C' ><span>Material properties</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S11'><span style="white-space: pre;"><span>c = 1.0;            </span><span style="color: rgb(60, 118, 61);">% Conductivity (homogeneous, linear, isotropic material)</span></span></div></div></div><h2  class = 'S5' id = 'H_638E11C5' ><span>General Settings</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>[sets.nel, sets.nxe]  = size(Mesh.elements);    </span><span style="color: rgb(60, 118, 61);">% Number of elements in the mesh &amp; Number of nodes per element</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>[sets.nnod, sets.dim] = size(Mesh.nodes);       </span><span style="color: rgb(60, 118, 61);">% Number of nodes in the mesh &amp; Space dimension</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.dxn = 1;                                   </span><span style="color: rgb(60, 118, 61);">% Number of DOFs per node for the scalar problem</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.edof = sets.dxn * sets.nxe;                </span><span style="color: rgb(60, 118, 61);">% Number of DOFs per element</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.sz = (sets.edof * (sets.edof + 1) )/2;     </span><span style="color: rgb(60, 118, 61);">% Number of NNZ values for each Ke using simmetry</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>sets.tdofs = sets.nnod * sets.dxn;              </span><span style="color: rgb(60, 118, 61);">% Number of total DOFs in the mesh</span></span></div></div></div><h2  class = 'S5' id = 'H_B41C36B4' ><span>GPU Settings</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>d = gpuDevice;                          </span><span style="color: rgb(60, 118, 61);">% Selects the GPU device </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.tbs      = d.MaxThreadsPerBlock;   </span><span style="color: rgb(60, 118, 61);">% Thread Block Size</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>sets.numSMs   = d.MultiprocessorCount;  </span><span style="color: rgb(60, 118, 61);">% Number of multiprocessors on the device</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>sets.WarpSize = d.SIMDWidth;            </span><span style="color: rgb(60, 118, 61);">% The warp size in threads</span></span></div></div></div><h2  class = 'S5' id = 'H_97FB7E91' ><span>Creation of global stiffness matrix on CPU (serial)</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>K_f = StiffMa_ss(Mesh, c, sets);	</span><span style="color: rgb(60, 118, 61);">% Assembly on CPU: K</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>time = toc;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\nElapsed time for building K on serial CPU: %f\n'</span><span>,time);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="6388F903" contenteditable="false" data-testid="output_1" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">Elapsed time for building K on serial CPU: 0.109501</div></div></div></div></div><h2  class = 'S5' id = 'H_74D8AFE6' ><span>Creation of global stiffness matrix on CPU (serial) taking advantage of symmetry</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>K_s = StiffMa_sss(Mesh, c, sets);  </span><span style="color: rgb(60, 118, 61);">% Assembly on CPU (tril(K))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>times = toc;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'Elapsed time for building tril(K) on serial CPU: %f\n'</span><span>,times);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="950F0802" contenteditable="false" data-testid="output_2" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">Elapsed time for building tril(K) on serial CPU: 0.171000</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tCPU speedup (CPU vs CPU, K vs tril(K)): %f\n'</span><span>,time/times);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="3AFFA3CB" contenteditable="false" data-testid="output_3" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	CPU speedup (CPU vs CPU, K vs tril(K)): 0.640359</div></div></div></div></div><h2  class = 'S5' id = 'H_CEE43F82' ><span>Creation of global stiffness matrix on GPU</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>elementsGPU = gpuArray(Mesh.elements');	</span><span style="color: rgb(60, 118, 61);">% Transfer to GPU memory</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>nodesGPU    = gpuArray(Mesh.nodes');  	</span><span style="color: rgb(60, 118, 61);">% Transfer to GPU memory</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>K_d = StiffMa_sps(elementsGPU, nodesGPU, c, sets);      </span><span style="color: rgb(60, 118, 61);">% Assembly on GPU (symmetric)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>time_d = toc;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>wait(d);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'Elapsed time for building tril(K) on parallel GPU: %f\n'</span><span>,time_d);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="EB3B52E5" contenteditable="false" data-testid="output_4" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">Elapsed time for building tril(K) on parallel GPU: 0.030768</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tGPU speedup (K vs tril(K)): %f\n'</span><span>,time/time_d);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="33C2DD03" contenteditable="false" data-testid="output_5" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	GPU speedup (K vs tril(K)): 3.558892</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S13'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tGPU speedup (tril(K) vs tril(K)): %f\n'</span><span>,times/time_d);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="D052A34E" contenteditable="false" data-testid="output_6" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	GPU speedup (tril(K) vs tril(K)): 5.557653</div></div></div></div></div><h2  class = 'S5' id = 'H_B7F87615' ><span>Difference between results</span></h2><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S9'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'Difference between results:\n'</span><span>);</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="E7E27180" contenteditable="false" data-testid="output_7" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">Difference between results:</div></div></div></div><div class="inlineWrapper"><div  class = 'S14'><span style="white-space: pre;"><span>K2 = tril(K_f);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tCPU vs CPU (K vs tril(K)): %e\n'</span><span>,norm(K2(:)-K_s(:)));</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="69AA2341" contenteditable="false" data-testid="output_8" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	CPU vs CPU (K vs tril(K)): 9.904795e-16</div></div></div></div><div class="inlineWrapper"><div  class = 'S14'><span style="white-space: pre;"><span>K_d2 = gather(K_d);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">'\tCPU vs GPU (tril(K) vs tril(K)): %e\n'</span><span>,norm(K_s(:)-K_d2(:)));</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="3CFF34D4" contenteditable="false" data-testid="output_9" style="width: 458px; max-height: 261px;" data-width="428" data-height="18" data-hashorizontaloverflow="false"><div class="textElement">	CPU vs GPU (tril(K) vs tril(K)): 2.879607e-15</div></div></div></div><div class="inlineWrapper"><div  class = 'S15'></div></div></div><h2  class = 'S5' id = 'H_DC2DCC8A' ><span>Credits</span></h2><div  class = 'S1'><span>Written by </span><span style=' font-weight: bold;'>Francisco Javier Ramírez-Gil</span><span>, </span><a href = "http://fjramireg@gmail.com"><span>fjramireg@gmail.com</span></a></div><div  class = 'S1'><span>Code site:</span></div><ul  class = 'S16'><li  class = 'S17'><a href = "https://github.com/fjramireg/StiffMa"><span>https://github.com/fjramireg/StiffMa</span></a></li><li  class = 'S17'><a href = "https://www.mathworks.com/matlabcentral/fileexchange/76947-stiffma"><span>https://www.mathworks.com/matlabcentral/fileexchange/76947-stiffma</span></a></li></ul><div  class = 'S1'><span>Sponsors: </span></div><ul  class = 'S16'><li  class = 'S17'><a href = "https://pascualbravo.edu.co/"><span>Institución Universitaria Pascual Bravo</span></a></li><li  class = 'S17'><a href = "https://medellin.unal.edu.co/"><span>Universidad Nacional de Colombia - Medellin</span></a></li></ul><div  class = 'S1'><span>Created:  28/01/2020. Version: 1.4</span></div><div  class = 'S1'><span>Modified: 13/06/2020. Version: 1.5</span></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Runs the whole assembly SCALAR code on the CPU and GPU: a comparision
% 
% 
% This script is used to generate the global stiffness matrix $$\mathbf{K}$$ 
% for the SCALAR problem (linear stationary thermal conduction) on the CPU and 
% GPU: a comparision.
% 
% For more information, see the <https://github.com/fjramireg/StiffMa StiffMa> 
% web site.
%% 
% 
%% Inputs

nelx = 10;              % Number of elements on X-direction
nely = 10;              % Number of elements on Y-direction
nelz = 10;              % Number of elements on Z-direction
sets.dTE = 'uint32';    % Data precision for "elements" ['uint32', 'uint64']
sets.dTN = 'double';    % Data precision for "nodes" ['single' or 'double']
%% Mesh generation

[Mesh.elements, Mesh.nodes] = CreateMesh2(nelx, nely, nelz, sets);
%% Material properties

c = 1.0;            % Conductivity (homogeneous, linear, isotropic material)
%% General Settings

[sets.nel, sets.nxe]  = size(Mesh.elements);    % Number of elements in the mesh & Number of nodes per element
[sets.nnod, sets.dim] = size(Mesh.nodes);       % Number of nodes in the mesh & Space dimension
sets.dxn = 1;                                   % Number of DOFs per node for the scalar problem
sets.edof = sets.dxn * sets.nxe;                % Number of DOFs per element
sets.sz = (sets.edof * (sets.edof + 1) )/2;     % Number of NNZ values for each Ke using simmetry
sets.tdofs = sets.nnod * sets.dxn;              % Number of total DOFs in the mesh
%% GPU Settings

d = gpuDevice;                          % Selects the GPU device 
sets.tbs      = d.MaxThreadsPerBlock;   % Thread Block Size
sets.numSMs   = d.MultiprocessorCount;  % Number of multiprocessors on the device
sets.WarpSize = d.SIMDWidth;            % The warp size in threads
%% Creation of global stiffness matrix on CPU (serial)

tic;
K_f = StiffMa_ss(Mesh, c, sets);	% Assembly on CPU: K
time = toc;
fprintf('\nElapsed time for building K on serial CPU: %f\n',time);
%% Creation of global stiffness matrix on CPU (serial) taking advantage of symmetry

tic;
K_s = StiffMa_sss(Mesh, c, sets);  % Assembly on CPU (tril(K))
times = toc;
fprintf('Elapsed time for building tril(K) on serial CPU: %f\n',times);
fprintf('\tCPU speedup (CPU vs CPU, K vs tril(K)): %f\n',time/times);
%% Creation of global stiffness matrix on GPU

tic;
elementsGPU = gpuArray(Mesh.elements');	% Transfer to GPU memory
nodesGPU    = gpuArray(Mesh.nodes');  	% Transfer to GPU memory
K_d = StiffMa_sps(elementsGPU, nodesGPU, c, sets);      % Assembly on GPU (symmetric)
time_d = toc;
wait(d);
fprintf('Elapsed time for building tril(K) on parallel GPU: %f\n',time_d);
fprintf('\tGPU speedup (K vs tril(K)): %f\n',time/time_d);
fprintf('\tGPU speedup (tril(K) vs tril(K)): %f\n',times/time_d);
%% Difference between results

fprintf('Difference between results:\n');
K2 = tril(K_f);
fprintf('\tCPU vs CPU (K vs tril(K)): %e\n',norm(K2(:)-K_s(:)));
K_d2 = gather(K_d);
fprintf('\tCPU vs GPU (tril(K) vs tril(K)): %e\n',norm(K_s(:)-K_d2(:)));

%% Credits
% Written by *Francisco Javier Ramírez-Gil*, <http://fjramireg@gmail.com fjramireg@gmail.com>
% 
% Code site:
%% 
% * <https://github.com/fjramireg/StiffMa https://github.com/fjramireg/StiffMa>
% * <https://www.mathworks.com/matlabcentral/fileexchange/76947-stiffma https://www.mathworks.com/matlabcentral/fileexchange/76947-stiffma>
%% 
% Sponsors: 
%% 
% * <https://pascualbravo.edu.co/ Institución Universitaria Pascual Bravo>
% * <https://medellin.unal.edu.co/ Universidad Nacional de Colombia - Medellin>
%% 
% Created:  28/01/2020. Version: 1.4
% 
% Modified: 13/06/2020. Version: 1.5
##### SOURCE END #####
--></body></html>